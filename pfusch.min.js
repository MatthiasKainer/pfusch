new WeakMap;function e(e){try{return e&&"string"==typeof e?JSON.parse(e):e}catch(t){return e}}const t=(e,...t)=>"string"==typeof e?e:e.reduce(((e,n,r)=>e+n+(t[r]||"")),"");export function css(e,...n){return{type:"style",content:()=>{var r=new CSSStyleSheet;return r.replaceSync(t(e,...n)),r}}}export const script=e=>({type:"script",content:e});const n=e=>([t,n])=>{try{"function"==typeof n?(e._re=e._re||[],e._re.indexOf(t)<0&&(e.addEventListener(t,n),e._re.push(t))):"object"==typeof n&&e.state?e.state[t]=n:e.setAttribute(t,"object"==typeof n?JSON.stringify(n):n)}catch(n){console.error(`Cannot add ${t} to ${e.tagName}`,n)}},r=(e,t)=>{e.id=t,n(e)(["id",t])};class s{element=null;state={};constructor(e,...r){if(this.element=document.createElement(e),r){this.state=r[0];for(let e=0;e<r.length;e++){let i=r[e];if(Array.isArray(i)||"object"==typeof i){if(i&&Array.isArray(i)&&i.raw){this.element.innerHTML=t(i,...r.slice(e+1));break}i&&i instanceof s?this.element.appendChild(i.element):i&&"object"==typeof i&&Object.entries(i).forEach(n(this.element))}else this.element.innerHTML=i}}}}export const html=new Proxy({},{get:(e,t)=>(...e)=>new s(t,...e)});export function pfusch(t,i,o){o||(o=i,i={}),i={id:"",...i};class a extends HTMLElement{fullRerender=!0;elements=[];constructor(){super();var t;this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=this.innerHTML,this.state=(t=()=>this.render(),new Proxy({...i},{set:function(e,n,r){const s=e[n];return e[n]=r,s!==r&&t(),!0},get:function(e,t){return e[t]}})),Object.keys(i).forEach((t=>{this.hasAttribute(t)&&(this.state[t]=e(this.getAttribute(t)))})),this.render()}static get observedAttributes(){return["id",...Object.entries(i).filter((([e,t])=>"object"!=typeof t)).map((([e])=>e))]}attributeChangedCallback(t,n,r){n!==r&&(this.state[t]=e(r))}triggerEvent(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}render(){const e=o(this.state,this.triggerEvent.bind(this)).filter((e=>e)),t=[...e.filter((e=>"style"===e.type)),css`${window.document.getElementById("pfusch-style")?.innerText||""}`],i=[...e.filter((e=>e instanceof s))],a=e.filter((e=>"script"===e.type));for(let e=i.length-1;e>=0;e--)if("template"!==i[e].element.getAttribute("as")){const{element:t}=i[e],n=this.shadowRoot.getElementById(t.id);if(n){n.parentNode.replaceChild(t,n),i.splice(e,1)}}else{const{element:t,state:s}=i[e],o=t.tagName.toLowerCase();[...this.shadowRoot.querySelectorAll(o)].forEach(((e,t)=>{e.index=t,r(e,e.id||`${o}-${t}`);Object.entries(s).map(n(e)),s.apply&&s.apply(e,t)})),i.splice(e,1)}const c=Array.from(this.shadowRoot.children);i.forEach(((e,t)=>{const n=e.element;r(n,n.id||`${n.tagName.toLowerCase()}-${t}`);const s=c.find((e=>e.id===n.id));s?s.isEqualNode(n)||this.shadowRoot.replaceChild(n,s):this.shadowRoot.appendChild(n)})),this.shadowRoot.adoptedStyleSheets=t.map((e=>e.content())),this.fullRerender&&(this.fullRerender=!1,a.forEach((e=>e.content(this))))}}return customElements.define(t,a),a}
