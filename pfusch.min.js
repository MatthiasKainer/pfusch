const e="string",t="object";function s(t){try{return t&&typeof t===e?JSON.parse(t):t}catch(e){return t}}const n=(t,...s)=>typeof t===e?t:t.reduce(((e,t,n)=>e+t+(s[n]||"")),"");export function css(e,...t){return{type:"style",content:()=>{var s=new CSSStyleSheet;return s.replaceSync(n(e,...t)),s}}}export const script=e=>({type:"script",content:e});const r=e=>([s,n])=>{parseInt(s,10)!=s&&("function"==typeof n?(e._re??=[],e._re.indexOf(s)<0&&(e.addEventListener(s,n),e._re.push(s))):typeof n===t&&e.state?e.state[s]=n:e.setAttribute(s,typeof n===t?JSON.stringify(n):n))},i=(e,t)=>{e.id=t,r(e)(["id",t])};class o{element=null;state={};constructor(e,...s){if(this.element=document.createElement(e),s){this.state=s[0];for(let e=0;e<s.length;e++){let i=s[e];if(Array.isArray(i)||typeof i===t){if(i&&Array.isArray(i)&&i.raw){this.element.innerHTML=n(i,...s.slice(e+1));break}i&&i instanceof o?this.element.appendChild(i.element):i&&typeof i===t&&Object.entries(i).forEach(r(this.element))}else this.element.innerHTML=i}}}}export const html=new Proxy({},{get:(e,t)=>(...e)=>new o(t,...e)});export function pfusch(e,n,a){a||(a=n,n={}),n={id:"",...n};class c extends HTMLElement{fullRerender=!0;elements=[];constructor(){super();var e;this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=this.innerHTML,this.state=(e=()=>this.render(),new Proxy({...n},{set:function(t,s,n){return t[s]!==n&&(t[s]=n,e()),!0},get:(e,t)=>e[t]})),Object.keys(n).forEach((e=>{this.hasAttribute(e)&&(this.state[e]=s(this.getAttribute(e)))})),this.render()}static get observedAttributes(){return["id",...Object.entries(n).filter((([e,s])=>typeof s!==t)).map((([e])=>e))]}attributeChangedCallback(e,t,n){t!==n&&(this.state[e]=s(n))}triggerEvent(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}render(){const e=a(this.state,this.triggerEvent.bind(this)).filter(Boolean),t=[...e.filter((e=>"style"===e.type)),css`${window.document.getElementById("pfusch-style")?.innerText||""}`],s=e.filter((e=>e instanceof o)),n=e.filter((e=>"script"===e.type)),c=(e,t)=>{const s=e.tagName.toLowerCase();this.shadowRoot.querySelectorAll(s).forEach(((e,n)=>{e.index=n,i(e,e.id||`${s}-${n}`),Object.entries(t).forEach(r(e)),t.apply?.(e,n)}))};s.slice().reverse().forEach(((e,t)=>{const{element:n,state:r}=e;if("interactive"!==n.getAttribute("as")){const e=this.shadowRoot.getElementById(n.id);e&&(e.parentNode.replaceChild(n,e),s.splice(s.length-1-t,1))}else c(n,r),s.splice(s.length-1-t,1)}));const l=Array.from(this.shadowRoot.children);s.forEach(((e,t)=>{const s=e.element;i(s,s.id||`${s.tagName.toLowerCase()}-${t}`);const n=l.find((e=>e.id===s.id));n?n.isEqualNode(s)||this.shadowRoot.replaceChild(s,n):this.shadowRoot.appendChild(s)})),this.shadowRoot.adoptedStyleSheets=t.map((e=>e.content())),this.fullRerender&&(this.fullRerender=!1,n.forEach((e=>e.content(this))))}}return customElements.define(e,c),c}
