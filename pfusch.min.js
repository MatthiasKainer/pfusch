let e=new WeakMap,t=0;const n="string";function r(e){try{return e&&typeof e!==n?JSON.parse(e):e}catch(t){return e}}const s=(e,...t)=>typeof e===n?e:e.reduce(((e,n,r)=>e+n+(t[r]||"")),"");export function css(e,...t){return{type:"style",content:()=>{var n=new CSSStyleSheet;return n.replaceSync(s(e,...t)),n}}}export const script=e=>({type:"script",content:e});class i{element=null;constructor(r,...o){if(this.element=document.createElement(r),o){for(let e=0;e<o.length;e++){let t=o[e];if(typeof t===n)this.element.innerHTML=t;else{if(t&&Array.isArray(t)&&t.raw){this.element.innerHTML=s(t,...o.slice(e+1));break}t&&t instanceof i?this.element.appendChild(t.element):t&&"object"==typeof t&&Object.entries(t).forEach((([e,t])=>{try{"function"==typeof t?this.element.addEventListener(e,t):this.element.setAttribute(e,"object"==typeof t?JSON.stringify(t):t)}catch(t){console.error(`Cannot add ${e} to ${r}`,t)}}))}}var h;""===this.element.id&&(this.element.id=`${r}-${h=this.element,e.has(h)||e.set(h,++t),e.get(h)}`)}}}export const html=new Proxy({},{get:(e,t)=>(...e)=>new i(t,...e)});export function pfusch(e,t,n){n||(n=t,t={});class s extends HTMLElement{fullRerender=!0;elements=[];constructor(){super();var e;this.attachShadow({mode:"open"}),this.state=(e=()=>this.render(),new Proxy({...t},{set:function(t,n,r){return t[n]=r,e(),!0}})),Object.keys(t).forEach((e=>{this.hasAttribute(e)&&(this.state[e]=r(this.getAttribute(e)))})),this.render()}static get observedAttributes(){return Object.keys(t)}attributeChangedCallback(e,t,n){t!==n&&(this.state[e]=r(n))}triggerEvent(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}render(){const e=n(this.state,this.triggerEvent.bind(this)),t=e.filter((e=>"style"===e.type)),r=[...e.filter((e=>e instanceof i))],s=e.filter((e=>"script"===e.type)),o=Array.from(this.shadowRoot.children);r.forEach((e=>{const t=e.element,n=o.find((e=>e.id===t.id));n?n.isEqualNode(t)||this.shadowRoot.replaceChild(t,n):this.shadowRoot.appendChild(t)})),o.forEach((e=>{r.find((t=>t.element.id===e.id))||this.shadowRoot.removeChild(e)})),this.shadowRoot.adoptedStyleSheets=t.map((e=>e.content())),this.fullRerender&&(this.fullRerender=!1,s.forEach((e=>e.content(this.shadowRoot))))}}return customElements.define(e,s),s}
