<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pfusch - Rapid Prototyping with Zero Build Tools</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" data-pfusch>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css" data-pfusch>
    <style id="pfusch-style">
        :root {
            --primary-color: #5b21b6;
            --primary-light: #7c3aed;
            --secondary-color: #059669;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f9fafb;
            --border-color: #e5e7eb;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            background: #ffffff;
        }

        .hero {
            background: linear-gradient(135deg, #5b21b6 0%, #7c3aed 50%, #a855f7 100%);
            color: white;
            padding: 5rem 2rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .hero h1 {
            font-size: 4rem;
            margin: 0 0 1rem 0;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .hero .tagline {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
            opacity: 1;
        }

        .hero > p {
            font-size: 1.25rem;
            opacity: 0.95;
            margin-bottom: 2rem;
        }

        .hero .stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .hero .stat {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .hero .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            display: block;
            margin-bottom: 0.25rem;
        }

        .hero .stat-label {
            font-size: 0.875rem;
            opacity: 0.95;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .section {
            margin-bottom: 5rem;
        }

        .section-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-weight: 800;
        }

        .section-subtitle {
            font-size: 1.25rem;
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .feature-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            border-color: var(--primary-light);
            box-shadow: 0 8px 16px rgba(91, 33, 182, 0.1);
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 0.75rem;
        }

        .feature-card p {
            color: var(--text-light);
            line-height: 1.6;
        }

        .example-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 3rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }

        .example-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .example-header {
            background: var(--bg-light);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .example-title {
            margin: 0 0 0.5rem 0;
            color: var(--primary-color);
            font-weight: 700;
        }

        .example-description {
            margin: 0;
            color: var(--text-light);
        }

        .example-demo {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            background: #fafbfc;
        }

        .example-code {
            background: var(--code-bg);
            padding: 0;
            position: relative;
        }

        .example-code::before {
            content: "CODE";
            position: absolute;
            top: 0.75rem;
            right: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: rgba(226, 232, 240, 0.5);
            letter-spacing: 0.05em;
        }

        .example-code pre {
            margin: 0;
            padding: 2rem 1.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
            line-height: 1.7;
            font-family: 'Monaco', 'Menlo', 'Consolas', 'Courier New', monospace;
        }

        .example-code code {
            color: var(--code-text);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Syntax highlighting for code */
        .example-code pre {
            color: #e2e8f0;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <h1>ðŸš€ Pfusch</h1>
        <p class="tagline">Rapid Prototyping with Zero Build Tools</p>
        <p>No npm. No bundler. No build step. Just results in minutes.</p>
        
        <div class="stats">
            <div class="stat">
                <span class="stat-value">286</span>
                <span class="stat-label">Lines of Code</span>
            </div>
            <div class="stat">
                <span class="stat-value">2.9K</span>
                <span class="stat-label">Gzipped</span>
            </div>
            <div class="stat">
                <span class="stat-value">0</span>
                <span class="stat-label">Dependencies</span>
            </div>
        </div>
    </div>

    <!-- Why Pfusch -->
    <div class="content">
        <div class="section">
            <h2 class="section-title">Why Pfusch?</h2>
            
            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <h3>Instant Setup</h3>
                    <p>Drop a script tag in your HTML and start building. No configuration files, no package.json, no webpack.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">ðŸŽ¨</div>
                    <h3>Design System Ready</h3>
                    <p>Works seamlessly with Pure CSS, Bootstrap, Tailwind, or your own CSS. Shadow DOM integration built-in.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">ðŸ”„</div>
                    <h3>Progressive Enhancement</h3>
                    <p>Start with semantic HTML, enhance with interactivity. Works without JavaScript, better with it.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">ðŸ“¦</div>
                    <h3>Zero Dependencies</h3>
                    <p>No node_modules folder with 500MB of packages. No build pipeline. No fighting with tooling.</p>
                </div>
            </div>
        </div>

        <!-- Quick Start -->
        <div class="section">
            <h2 class="section-title">Get Started in 30 Seconds</h2>
            
            <div class="example-code">
                <pre><code>&lt;script type="module"&gt;
  import { pfusch, html } from "https://matthiaskainer.github.io/pfusch/pfusch.min.js";
  
  pfusch("live-counter", { count: 0 }, (state) => [
    html.div(
      html.p`Count: ${state.count}`,
      html.button({ click: () => state.count++ }, "Increment")
    )
  ]);
&lt;/script&gt;

&lt;live-counter&gt;&lt;/live-counter&gt;</code></pre>
            </div>
        </div>

        <!-- Examples -->
        <div class="section">
            <h2 class="section-title">Interactive Examples</h2>
            
            <!-- Example 1: Counter -->
            <div class="example-card">
                <div class="example-header">
                    <h3 class="example-title">Simple Counter</h3>
                    <p class="example-description">Reactive state management with direct mutation</p>
                </div>
                
                <div class="example-demo">
                    <my-counter count="10"></my-counter>
                </div>
                
                <div class="example-code">
                    <pre><code>pfusch("my-counter", { count: 0 }, (state) => [
  html.div(
    html.p`Count: ${state.count}`,
    html.button({ 
      click: () => state.count++ 
    }, "Increment")
  )
]);</code></pre>
                </div>
            </div>

            <!-- Example 2: Event-Driven -->
            <div class="example-card">
                <div class="example-header">
                    <h3 class="example-title">Event-Driven Architecture</h3>
                    <p class="example-description">Loosely-coupled components with global events</p>
                </div>
                
                <div class="example-demo">
                    <event-counter></event-counter>
                    <counter-display 
                        eventIncrement="event-counter.increment"
                        eventDecrement="event-counter.decrement"
                        eventReset="event-counter.reset">
                    </counter-display>
                </div>
                
                <div class="example-code">
                    <pre><code>// Component that triggers events
pfusch("event-counter", {}, (state, trigger) => [
  html.button({ 
    click: () => trigger("increment") 
  }, "Increment")
]);

// Component that listens to events
pfusch("counter-display", { count: 0, eventIncrement: "" }, (state) => [
  script(function() {
    window.addEventListener(state.eventIncrement, () => {
      state.count++;
    });
  }),
  html.div`Count: ${state.count}`
]);</code></pre>
                </div>
            </div>

            <!-- Example 3: Forms -->
            <div class="example-card">
                <div class="example-header">
                    <h3 class="example-title">Form Validation</h3>
                    <p class="example-description">Native form integration with live validation</p>
                </div>
                
                <div class="example-demo">
                    <form-validator>
                        <form id="test-form" class="pure-form pure-form-stacked">
                            <my-input name="username" placeholder="Enter username" required="true"></my-input>
                            <my-input name="email" type="email" placeholder="Enter email" required="true"></my-input>
                            <button type="submit" id="submit-btn" class="pure-button pure-button-primary">Submit</button>
                        </form>
                    </form-validator>
                </div>
                
                <div class="example-code">
                    <pre><code>pfusch("my-input", {
  name: "", value: "", required: false, errorMessage: ""
}, (state, trigger) => [
  html.input({
    name: state.name,
    value: state.value,
    required: state.required,
    input: (e) => {
      state.value = e.target.value;
      // Validation logic...
      trigger("validation", { name, isValid, errorMessage });
    }
  }),
  state.errorMessage ? html.div(state.errorMessage) : null
]);</code></pre>
                </div>
            </div>

            <!-- Example 4: Todo App -->
            <div class="example-card">
                <div class="example-header">
                    <h3 class="example-title">Todo Application</h3>
                    <p class="example-description">Component composition and state management</p>
                </div>
                
                <div class="example-demo">
                    <todo-app 
                        todos="[{&quot;id&quot;:1,&quot;text&quot;:&quot;Learn pfusch&quot;,&quot;completed&quot;:false},{&quot;id&quot;:2,&quot;text&quot;:&quot;Learn JavaScript &quot;,&quot;completed&quot;:true},{&quot;id&quot;:3,&quot;text&quot;:&quot;Learn html&quot;,&quot;completed&quot;:true}]">
                    </todo-app>
                </div>
                
                <div class="example-code">
                    <pre><code>pfusch("todo-app", { todos: [] }, (state) => [
  html.div(
    html.input({
      keydown: (e) => {
        if (e.key === 'Enter') {
          state.todos = [...state.todos, {
            id: Date.now(),
            text: e.target.value,
            completed: false
          }];
          e.target.value = '';
        }
      }
    }),
    html.ul(
      ...state.todos.map(todo =>
        html["todo-item"]({ ...todo })
      )
    )
  )
]);</code></pre>
                </div>
            </div>

            <!-- Example 5: Progressive Enhancement -->
            <div class="example-card">
                <div class="example-header">
                    <h3 class="example-title">Progressive Enhancement</h3>
                    <p class="example-description">Enhance existing HTML with interactivity</p>
                </div>
                
                <div class="example-demo">
                    <enhanced-table>
                        <table class="pure-table pure-table-bordered">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                </tr>
                            </thead>
                            <tbody id="table-content">
                                <tr>
                                    <td>Zebra Project</td>
                                    <td>Active</td>
                                    <td>High</td>
                                </tr>
                                <tr>
                                    <td>Apple Initiative</td>
                                    <td>Pending</td>
                                    <td>Low</td>
                                </tr>
                                <tr>
                                    <td>Mango Task</td>
                                    <td>Active</td>
                                    <td>Medium</td>
                                </tr>
                                <tr>
                                    <td>Banana Feature</td>
                                    <td>Completed</td>
                                    <td>High</td>
                                </tr>
                            </tbody>
                        </table>
                    </enhanced-table>
                </div>                <div class="example-code">
                    <pre><code>pfusch("enhanced-table", { sortBy: null, items: [], columns: [] }, 
  (state, trigger, { children }) => {
  const sortItems = (items, sortBy) => {
    if (!sortBy) return items;
    return [...items].sort((a, b) => 
      String(a[sortBy]).localeCompare(String(b[sortBy]))
    );
  };
  
  return [
    script(function() {
      // Extract data from existing table in light DOM
      const tables = children('table');
      const headers = Array.from(tables[0].querySelectorAll('thead th'));
      
      // Build columns dynamically from headers
      state.columns = headers.map(th => ({
        name: th.textContent.trim(),
        key: th.textContent.trim().toLowerCase()
      }));
      
      // Build items dynamically from rows
      const rows = Array.from(tables[0].querySelectorAll('tbody tr'));
      state.items = rows.map(row => {
        const cells = row.querySelectorAll('td');
        const item = {};
        state.columns.forEach((col, idx) => {
          item[col.key] = cells[idx]?.textContent?.trim() || '';
        });
        return item;
      });
    }),
    // Add sort buttons
    html.div(
      ...state.columns.map(col =>
        html.button({ 
          click: () => state.sortBy = col.key 
        }, `Sort by ${col.name}`)
      ),
      html.button({ click: () => state.sortBy = null }, "Clear")
    ),
    // Show original while loading, then sorted table
    state.loading ? html.slot() : renderSortedTable(state)
  ];
});</code></pre>
                </div>
            </div>
        </div>

        <!-- CTA -->
        <div class="section" style="text-align: center; padding: 4rem 0;">
            <h2 class="section-title">Ready to Build Something?</h2>
            <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                Stop fighting with build tools. Start building.
            </p>
            <a href="https://github.com/MatthiasKainer/pfusch" class="pure-button pure-button-primary" style="font-size: 1.2rem; padding: 1rem 3rem;">
                View on GitHub
            </a>
            <a href="./Readme.md" class="pure-button" style="font-size: 1.2rem; padding: 1rem 3rem; margin-left: 1rem;">
                Read the Docs
            </a>
        </div>
    </div>

    <script type="module">
        import { pfusch, html, css, script } from './pfusch.js';

        // Counter Component
        pfusch("my-counter", { count: 0 }, (state, trigger) => [
            css`
                .counter-container {
                    border: 2px solid #667eea;
                    padding: 20px;
                    border-radius: 8px;
                    text-align: center;
                }
                .count-display {
                    font-size: 32px;
                    font-weight: bold;
                    color: #667eea;
                    margin: 15px 0;
                }
                button {
                    background: #667eea;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    margin: 0 5px;
                    border-radius: 4px;
                    cursor: pointer;
                }
                button:hover {
                    background: #5568d3;
                }
            `,
            html.div({ class: "counter-container" },
                html.div({ class: "count-display" }, `Count: ${state.count}`),
                html.button({
                    id: "increment-btn",
                    click: () => {
                        state.count++;
                        trigger("incremented", { newValue: state.count });
                    }
                }, "Increment"),
                html.button({
                    id: "decrement-btn",
                    click: () => {
                        state.count--;
                        trigger("decremented", { newValue: state.count });
                    }
                }, "Decrement"),
                html.button({
                    id: "reset-btn",
                    click: () => {
                        state.count = 0;
                        trigger("reset", { newValue: 0 });
                    }
                }, "Reset")
            )
        ]);

        // Event-driven counter
        pfusch("event-counter", {}, (state, trigger) => [
            css`
                .event-counter {
                    border: 2px solid #41b883;
                    padding: 20px;
                    border-radius: 8px;
                    text-align: center;
                    margin-bottom: 20px;
                }
                button {
                    background: #41b883;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    margin: 0 5px;
                    border-radius: 4px;
                    cursor: pointer;
                }
                button:hover {
                    background: #35a372;
                }
            `,
            html.div({ class: "event-counter" },
                html.button({
                    id: "event-increment-btn",
                    click: () => trigger("increment")
                }, "Increment"),
                html.button({
                    id: "event-decrement-btn",
                    click: () => trigger("decrement")
                }, "Decrement"),
                html.button({
                    id: "event-reset-btn",
                    click: () => trigger("reset")
                }, "Reset")
            )
        ]);

        pfusch("counter-display", {
            count: 0,
            eventIncrement: "",
            eventDecrement: "",
            eventReset: ""
        }, (state) => [
            css`
                .counter-display {
                    border: 2px dashed #41b883;
                    padding: 20px;
                    border-radius: 8px;
                    text-align: center;
                }
                .count-value {
                    font-size: 32px;
                    font-weight: bold;
                    color: #41b883;
                }
            `,
            script(function() {
                this._inc = () => { state.count++; };
                this._dec = () => { state.count--; };
                this._reset = () => { state.count = 0; };
                window.addEventListener(state.eventIncrement, this._inc);
                window.addEventListener(state.eventDecrement, this._dec);
                window.addEventListener(state.eventReset, this._reset);
                this.component.addEventListener("disconnected", () => {
                    window.removeEventListener(state.eventIncrement, this._inc);
                    window.removeEventListener(state.eventDecrement, this._dec);
                    window.removeEventListener(state.eventReset, this._reset);
                });
            }),
            html.div({ class: "counter-display" },
                html.div({ class: "count-value" }, `Count: ${state.count}`)
            )
        ]);

        // Form Input Component
        pfusch("my-input", {
            name: "",
            placeholder: "",
            value: "",
            type: "text",
            maxLength: 50,
            required: false,
            errorMessage: "",
            isValid: true,
            hasBlurred: false
        }, (state, trigger) => [
            css`
                .input-group {
                    margin: 10px 0;
                }
                label {
                    display: block;
                    margin-bottom: 5px;
                    font-weight: bold;
                }
                input {
                    width: 100%;
                    padding: 8px 12px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    font-size: 14px;
                    box-sizing: border-box;
                }
                input:focus {
                    outline: none;
                    border-color: #667eea;
                }
                input.custom-invalid {
                    border-color: #dc3545;
                }
                input.custom-valid {
                    border-color: #41b883;
                }
                .char-counter {
                    font-size: 12px;
                    color: #666;
                    margin-top: 4px;
                }
                .error-message {
                    color: #dc3545;
                    font-size: 12px;
                    margin-top: 4px;
                }
                .valid-message {
                    color: #41b883;
                    font-size: 12px;
                    margin-top: 4px;
                }
            `,
            script(function() {
                let inputElement = null;
                const componentContext = this.component;

                const validateInput = (value = state.value, showErrors = state.hasBlurred) => {
                    let errorMessage = '';
                    let isValid = true;

                    if (state.required && (!value || value.trim() === '')) {
                        errorMessage = 'This field is required';
                        isValid = false;
                    } else if (state.type === 'email' && value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                        errorMessage = 'Please enter a valid email address';
                        isValid = false;
                    } else if (value && value.length > state.maxLength) {
                        errorMessage = `Maximum ${state.maxLength} characters allowed`;
                        isValid = false;
                    }

                    state.errorMessage = showErrors ? errorMessage : '';
                    state.isValid = isValid;

                    if (inputElement) {
                        inputElement.setCustomValidity(errorMessage);
                        inputElement.classList.remove('custom-valid', 'custom-invalid');
                        if (showErrors) {
                            if (isValid && value) {
                                inputElement.classList.add('custom-valid');
                            } else if (!isValid) {
                                inputElement.classList.add('custom-invalid');
                            }
                        }
                    }

                    trigger('validation', {
                        name: state.name,
                        isValid,
                        errorMessage,
                        value
                    });

                    return isValid;
                };

                state.subscribe('value', (newValue) => {
                    validateInput(newValue, state.hasBlurred);
                });

                setTimeout(() => {
                    if (componentContext && componentContext.shadowRoot) {
                        inputElement = componentContext.shadowRoot.querySelector('input');
                        validateInput(state.value, false);
                    }
                }, 0);
            }),
            html.div({ class: "input-group" },
                html.label({ for: `input-${state.name}` }, state.placeholder),
                html.input({
                    id: `input-${state.name}`,
                    name: state.name,
                    placeholder: state.placeholder,
                    type: state.type,
                    value: state.value,
                    maxlength: state.maxLength,
                    required: state.required,
                    input: (e) => {
                        state.value = e.target.value;
                    },
                    keydown: (e) => {
                        if (e.key === "Enter") {
                            const host = e.target.getRootNode().host;
                            if (host) {
                                host.dispatchEvent(new CustomEvent("submit", {
                                    bubbles: true,
                                    composed: true
                                }));
                            }
                        }
                    },
                    blur: () => {
                        state.hasBlurred = true;
                    }
                }),
                html.div({
                    id: `counter-${state.name}`,
                    class: 'char-counter'
                }, `${state.value.length}/${state.maxLength} characters`),
                state.errorMessage ?
                    html.div({ class: "error-message" }, state.errorMessage) :
                    (state.isValid && state.value && state.hasBlurred ?
                        html.div({ class: "valid-message" }, "âœ“ Valid") : null)
            )
        ]);

        // Form validator
        pfusch("form-validator", {
            fieldStates: new Map(),
            isFormValid: false
        }, (state, trigger, { children }) => [
            script(function() {
                const componentContext = this.component;

                componentContext.addEventListener('my-input.validation', (e) => {
                    const { name, isValid, errorMessage, value } = e.detail;
                    state.fieldStates.set(name, { isValid, errorMessage, value, hasValue: !!value });

                    const allValid = Array.from(state.fieldStates.values()).every(field => field.isValid);
                    const hasRequiredFields = Array.from(state.fieldStates.values()).some(field => field.hasValue);

                    state.isFormValid = allValid && hasRequiredFields;

                    setTimeout(() => {
                        if (componentContext && componentContext.shadowRoot) {
                            const submitButton = componentContext.shadowRoot.querySelector('button[type="submit"]');
                            if (submitButton) {
                                submitButton.disabled = !state.isFormValid;
                            }
                        }
                    }, 0);
                });

                setTimeout(() => {
                    if (componentContext && componentContext.shadowRoot) {
                        const submitButton = componentContext.shadowRoot.querySelector('button[type="submit"]');
                        if (submitButton) {
                            submitButton.disabled = true;
                        }
                    }
                }, 0);
            }),
            html.slot()
        ]);

        // Todo item
        pfusch("todo-item", { id: "", text: "", completed: false }, (state, trigger) => [
            css`
                .todo-item {
                    display: flex;
                    align-items: center;
                    padding: 10px;
                    border-bottom: 1px solid #eee;
                }
                .todo-item.completed .todo-text {
                    text-decoration: line-through;
                    opacity: 0.6;
                }
                .todo-text {
                    flex: 1;
                    margin: 0 10px;
                }
                .delete-btn {
                    background: #dc3545;
                    color: white;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 4px;
                    cursor: pointer;
                }
            `,
            html.div({
                class: `todo-item ${state.completed ? 'completed' : ''}`,
                id: `todo-${state.id}`
            },
                html.input({
                    type: "checkbox",
                    checked: state.completed,
                    change: () => {
                        state.completed = !state.completed;
                        trigger("toggle", state);
                    }
                }),
                html.span({ class: "todo-text" }, state.text),
                html.button({
                    class: "delete-btn",
                    click: () => trigger("delete", state)
                }, "Delete")
            )
        ]);

        // Todo app
        pfusch("todo-app", { todos: [], nextId: 1 }, (state) => [
            css`
                .todo-app {
                    max-width: 500px;
                    margin: 20px auto;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    overflow: hidden;
                }
                .todo-header {
                    background: #f8f9fa;
                    padding: 20px;
                    border-bottom: 1px solid #ddd;
                }
                .todo-input {
                    width: 100%;
                    padding: 10px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    font-size: 16px;
                    box-sizing: border-box;
                }
                .todo-list {
                    max-height: 300px;
                    overflow-y: auto;
                }
                .empty-state {
                    padding: 40px;
                    text-align: center;
                    color: #6c757d;
                }
            `,
            script(() => {
                state.subscribe('todos', (newTodos) => {
                    if (Array.isArray(newTodos) && newTodos.length > 0) {
                        const maxId = Math.max(...newTodos.map(todo => todo.id));
                        if (maxId >= state.nextId) {
                            state.nextId = maxId + 1;
                        }
                    }
                });
            }),
            html.div({ class: "todo-app" },
                html.div({ class: "todo-header" },
                    html.h3("Todo List"),
                    html.input({
                        class: "todo-input",
                        placeholder: "Add a new todo...",
                        keydown: (e) => {
                            if (e.key === 'Enter' && e.target.value.trim()) {
                                state.todos = [...state.todos, {
                                    id: state.nextId++,
                                    text: e.target.value.trim(),
                                    completed: false
                                }];
                                e.target.value = '';
                            }
                        }
                    })
                ),
                html.div({ class: "todo-list" },
                    state.todos.length === 0
                        ? html.div({ class: "empty-state" }, "No todos yet. Add one above!")
                        : state.todos.map(todo =>
                            html["todo-item"]({
                                ...todo,
                                "todo-item.toggle": (e) => {
                                    const index = state.todos.findIndex(t => t.id === e.detail.id);
                                    if (index >= 0) {
                                        const newTodos = [...state.todos];
                                        newTodos[index] = { ...newTodos[index], ...e.detail };
                                        state.todos = newTodos;
                                    }
                                },
                                "todo-item.delete": (e) => {
                                    state.todos = state.todos.filter(t => t.id !== e.detail.id);
                                }
                            })
                        )
                )
            )
        ]);

                // Enhanced table (sortable)
        pfusch("enhanced-table", { sortBy: null, items: [], columns: [], loading: true }, (state, trigger, { children }) => {
            const sortItems = (items, sortBy) => {
                if (!sortBy) return items;
                return [...items].sort((a, b) => 
                    String(a[sortBy]).localeCompare(String(b[sortBy]))
                );
            };
            
            return [
                css`
                    :host {
                        display: block;
                    }
                    .table-controls {
                        margin-bottom: 15px;
                    }
                    button {
                        background: #667eea;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        margin-right: 10px;
                        border-radius: 4px;
                        cursor: pointer;
                    }
                    button:hover {
                        background: #5568d3;
                    }
                `,
                script(function() {
                    // Extract data from original table in light DOM
                    const tables = children('table');
                    if (tables && tables.length > 0) {
                        const table = tables[0];
                        
                        // Extract column headers
                        const headers = Array.from(table.querySelectorAll('thead th'));
                        state.columns = headers.map(th => ({
                            name: th.textContent.trim(),
                            key: th.textContent.trim().toLowerCase()
                        }));
                        
                        // Extract rows and build items dynamically
                        const rows = Array.from(table.querySelectorAll('tbody tr'));
                        state.items = rows.map(row => {
                            const cells = row.querySelectorAll('td');
                            const item = {};
                            state.columns.forEach((col, index) => {
                                item[col.key] = cells[index]?.textContent?.trim() || '';
                            });
                            return item;
                        });
                    }
                    state.loading = false;
                }),
                // Add interactive controls
                html.div({ class: "table-controls" },
                    html.button({ 
                        id: "clear-sort-btn",
                        click: () => state.sortBy = null
                    }, "Clear Sort"),
                    ...state.columns.map((col) => 
                        html.button({ 
                            id: `sort-${col.key}-btn`,
                            click: () => state.sortBy = col.key
                        }, `Sort by ${col.name}`)
                    ),
                ),
                // Show original content while loading, then show sorted data
                state.loading 
                    ? html.slot()
                    : html.table({ class: "pure-table pure-table-bordered" },
                        html.thead(
                            html.tr(
                                ...state.columns.map(col => html.th(col.name))
                            )
                        ),
                        html.tbody(
                            ...sortItems(state.items, state.sortBy).map(item =>
                                html.tr(
                                    ...state.columns.map(col => html.td(item[col.key]))
                                )
                            )
                        )
                    )
            ];
        });

        // Form submission handler
        document.addEventListener('submit', (e) => {
            if (e.target.id === 'test-form') {
                e.preventDefault();

                const formValidator = e.target.closest('form-validator');
                if (!formValidator || !formValidator.state.isFormValid) {
                    const customInputs = e.target.querySelectorAll('my-input');
                    let firstInvalidField = null;

                    customInputs.forEach(input => {
                        const shadowInput = input.shadowRoot.querySelector('input');
                        if (shadowInput && !shadowInput.checkValidity()) {
                            if (!firstInvalidField) {
                                firstInvalidField = shadowInput;
                            }
                            shadowInput.reportValidity();
                        }
                    });

                    if (firstInvalidField) {
                        firstInvalidField.focus();
                    }
                    return;
                }

                const customInputs = e.target.querySelectorAll('my-input');
                const formData = {};
                customInputs.forEach(input => {
                    formData[input.getAttribute('name')] = input.state ? input.state.value : '';
                });

                console.log('Form submitted:', formData);

                const submitButton = e.target.querySelector('button[type="submit"]');
                const originalText = submitButton.textContent;
                submitButton.textContent = 'âœ“ Submitted!';
                submitButton.disabled = true;

                setTimeout(() => {
                    submitButton.textContent = originalText;
                    submitButton.disabled = false;
                    customInputs.forEach(input => {
                        if (input.state) {
                            input.state.value = '';
                            input.state.hasBlurred = false;
                            input.state.errorMessage = '';
                        }
                    });
                }, 2000);
            }
        });
    </script>
</body>
</html>
